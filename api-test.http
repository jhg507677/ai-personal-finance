### Ledger API 테스트
### IntelliJ HTTP Client 사용

### 변수 설정
@host = http://localhost:8080
@contentType = application/json

### 1. 회원가입 (테스트용 사용자 생성)
POST {{host}}/api/public/v1/client
Content-Type: {{contentType}}

{
  "userId": "testUser",
  "email": "test@example.com",
  "name": "테스트유저",
  "password": "password123"
}

> {%
client.global.set("accessToken", response.body.content.accessToken);
%}

### 2. 로그인
POST {{host}}/api/public/v1/client/login
Content-Type: {{contentType}}

{
  "userId": "testUser",
  "password": "password123"
}

> {%
client.global.set("accessToken", response.body.content.accessToken);
%}

###############################################
### Ledger API 테스트 (인증 필요)
###############################################

### 3. 거래 내역 생성 (지출)
POST {{host}}/api/v1/client/ledgers
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "type": "EXPENSE",
  "amount": 50000,
  "desc": "점심 식사",
  "place": "식당",
  "category": "FOOD",
  "paymentMethod": "CARD",
  "recordedDate": "2024-02-20"
}

> {%
client.global.set("ledgerId", response.body.content.ledgerIdx);
%}

### 4. 거래 내역 생성 (수입)
POST {{host}}/api/v1/client/ledgers
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "type": "INCOME",
  "amount": 3000000,
  "desc": "월급",
  "category": "SUBSCRIPTION",
  "paymentMethod": "TRANSFER",
  "recordedDate": "2024-02-01"
}

### 5. 거래 내역 상세 조회
GET {{host}}/api/v1/client/ledgers/{{ledgerId}}
Authorization: Bearer {{accessToken}}

### 6. 거래 내역 수정
PUT {{host}}/api/v1/client/ledgers/{{ledgerId}}
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "amount": 60000,
  "desc": "저녁 식사",
  "place": "레스토랑"
}

### 7. 거래 내역 목록 조회 (전체)
GET {{host}}/api/v1/client/ledgers?page=0&size=10
Authorization: Bearer {{accessToken}}

### 8. 거래 내역 목록 조회 (지출만)
GET {{host}}/api/v1/client/ledgers?type=EXPENSE&page=0&size=10
Authorization: Bearer {{accessToken}}

### 9. 거래 내역 목록 조회 (카테고리 필터)
GET {{host}}/api/v1/client/ledgers?category=FOOD&page=0&size=10
Authorization: Bearer {{accessToken}}

### 10. 거래 내역 목록 조회 (날짜 범위)
GET {{host}}/api/v1/client/ledgers?startDate=2024-02-01&endDate=2024-02-28&page=0&size=10
Authorization: Bearer {{accessToken}}

### 11. 거래 내역 삭제 (Soft Delete)
DELETE {{host}}/api/v1/client/ledgers/{{ledgerId}}
Authorization: Bearer {{accessToken}}

### 12. 삭제된 거래 조회 시도 (404 에러 예상)
GET {{host}}/api/v1/client/ledgers/{{ledgerId}}
Authorization: Bearer {{accessToken}}

###############################################
### 유효성 검증 테스트
###############################################

### 13. 필수 필드 누락 (400 에러)
POST {{host}}/api/v1/client/ledgers
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "type": "EXPENSE",
  "desc": "점심 식사"
}

### 14. 음수 금액 (400 에러)
POST {{host}}/api/v1/client/ledgers
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "type": "EXPENSE",
  "amount": -1000,
  "desc": "테스트",
  "category": "FOOD",
  "paymentMethod": "CARD",
  "recordedDate": "2024-02-20"
}

### 15. 인증 없이 접근 (401 에러)
GET {{host}}/api/v1/client/ledgers

###############################################
### Budget API 테스트 (인증 필요)
###############################################

### 16. 예산 생성 (2024년 2월 식비 예산)
POST {{host}}/api/v1/client/budgets
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "2024년 2월 식비 예산",
  "budgetPeriod": "MONTHLY",
  "startDate": "2024-02-01",
  "endDate": "2024-02-29",
  "amount": 500000,
  "category": "FOOD",
  "alertThreshold": 80.00
}

> {%
client.global.set("budgetId", response.body.content.budgetIdx);
%}

### 17. 예산 생성 (2024년 2월 전체 예산)
POST {{host}}/api/v1/client/budgets
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "2024년 2월 전체 예산",
  "budgetPeriod": "MONTHLY",
  "startDate": "2024-02-01",
  "endDate": "2024-02-29",
  "amount": 2000000
}

### 18. 예산 상세 조회
GET {{host}}/api/v1/client/budgets/{{budgetId}}
Authorization: Bearer {{accessToken}}

### 19. 예산 사용 현황 조회 (핵심 기능!)
GET {{host}}/api/v1/client/budgets/{{budgetId}}/usage
Authorization: Bearer {{accessToken}}

### 20. 예산 목록 조회
GET {{host}}/api/v1/client/budgets
Authorization: Bearer {{accessToken}}

### 21. 예산 수정
PUT {{host}}/api/v1/client/budgets/{{budgetId}}
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "amount": 600000,
  "alertThreshold": 70.00
}

### 22. 예산 삭제 (Soft Delete)
DELETE {{host}}/api/v1/client/budgets/{{budgetId}}
Authorization: Bearer {{accessToken}}

### 23. 삭제된 예산 조회 시도 (에러 예상)
GET {{host}}/api/v1/client/budgets/{{budgetId}}
Authorization: Bearer {{accessToken}}

###############################################
### Budget 유효성 검증 테스트
###############################################

### 24. 필수 필드 누락 (400 에러)
POST {{host}}/api/v1/client/budgets
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "예산"
}

### 25. 음수 금액 (400 에러)
POST {{host}}/api/v1/client/budgets
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "테스트 예산",
  "budgetPeriod": "MONTHLY",
  "startDate": "2024-02-01",
  "endDate": "2024-02-29",
  "amount": -100000
}

### 26. 기간 중복 예산 생성 (에러 예상)
POST {{host}}/api/v1/client/budgets
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
  "name": "중복 예산",
  "budgetPeriod": "MONTHLY",
  "startDate": "2024-02-01",
  "endDate": "2024-02-29",
  "amount": 500000,
  "category": "FOOD"
}

###############################################
### 참고: 사용 가능한 Enum 값
###############################################
# LedgerType: INCOME, EXPENSE
# Category: FOOD, TRANSPORT, CAFE, SHOPPING, LIVING, COMMUNICATION, MEDICAL, EDUCATION, SUBSCRIPTION, ETC
# PaymentMethod: CASH, CARD, TRANSFER, ETC
# BudgetPeriod: WEEKLY, MONTHLY, YEARLY
